# 小马加编信息学教案(二十) 
# 深度优先搜索


<!-- @import "[TOC]" {cmd="toc" depthFrom=2 depthTo=6 orderedList=false} -->

<!-- code_chunk_output -->

* [一. 课程内容](#一-课程内容)
* [二. 知识讲解](#二-知识讲解)
	* [1. 深度优先搜索概念](#1-深度优先搜索概念)
	* [2. 深度优先搜索实现](#2-深度优先搜索实现)
	* [3. 深度优先搜索剪枝](#3-深度优先搜索剪枝)
* [三. 经典例题](#三-经典例题)
* [四. 提高巩固](#四-提高巩固)

<!-- /code_chunk_output -->
## 一. 课程内容
1. 深度优先搜索简介
2. 深度优先搜索实现
3. 深度优先搜索剪枝
---

## 二. 知识讲解

### 1. 深度优先搜索概念
>深度优先搜索称为dfs（depth first search）
我们常常用来解决这样的一类问题：
我们需要作出多步决策，每一步决策对后续和结果的影响不容易计算，那么可以使用dfs来枚举所有情况

>除此之外，使用dfs枚举所有可能的情况的方法，几乎可以用较低的效率解决所有涉及决策的问题。这就是常说的暴力方法，用以获得部分分。

>dfs的方式是在当前状态下，枚举所有可行的决策，依次作出枚举到的决策，然后进入新状态继续枚举。如果没有可选的决策，就退回上一个状态，枚举下一个可选的决策。

![Alt text](http://img.027cgb.com/615854/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-01-25%2015-57-24.png
 "optional title")


> 我们记S0,S1,...为状态，箭头为做了决策后的状态转移，S0为初始状态。那么深度优先搜索的搜索顺序是由S0->S1->S3->S7，然后退回S3，再转移到S8。再退回S1，再到S4......（结合例题讲解状态、转移等概念）

>注意状态序列，先搜索的状态后退出，后搜索的状态先退出，符合栈先进后出的特点。系统也是使用栈来存储递归结构的。

>注意状态之间可能会出现环形转移，即S1能转移到S2，S2也能转移到S1。
由于我们只需要搜索出所有可能出现的状态，那么转移到出现过的状态S'时我们就没有必要继续搜索S'。这样不会出现死循环的情况，并且能搜索到所有状态。
### 2. 深度优先搜索实现
>伪代码
```c++
void dfs(当前状态s)
{
    if(s为终止状态)
    {
        更新答案（如评估优劣，方案计数等）
        return；
    }
    for(每一种转移方式)
    {
        生成新状态s'
        if(s'是没有生成过的状态) dfs(s');
    }
}
```
>结合例题讲解
###3. 深度优先搜索剪枝
>试想我们搜索到一个状态时，我们已经可以确定接下来无论怎么决策，都不会对答案产生影响了，那么这个状态就没有继续搜索的必要了。

>比如在最优解问题中，我们当前状态一定会比已经搜索得出的当前最优解要劣，那就可以返回了。这个判断、返回的过程我们称为剪枝。

>剪枝的角度多种多样，需要在题目的练习中理解和领悟。

>剪枝是dfs常见的优化技巧，剪枝得当可以有效改善dfs的效率。

## 三. 经典例题
1. 生成排列
>在1,...,n中选出r个数进行排列。按字典序输出所有排列。
   $0<r<n<20$

>输入格式：第一行两个整数n，r

>输出格式：每行一个排列，按字典序升序输出

样例输入 | 样例输出
------------ | ------------
 3 2 | 1 2 </br> 1 3 </br> 2 1 </br> 2 3 </br> 3 1 </br> 3 2

2. 数的拆分
>输入n，输出将n拆分成若干正整数的和的所有方案。按字典序升序输出。
$n \le 20$

>输入格式：第一行一个数字n

>输出格式：每行一个拆分方案，按字典序升序输出

样例输入 | 样例输出
------------ | ------------
 4 | 1+1+1+1 </br> 1+1+2 </br> 1+3 </br> 2+2 </br> 4 

3.密码问题
>一个有效的密码由L个小写英文字母组成，至少有一个元音和两个辅音。
并且密码中的字母应按照字母表升序出现（如abc有效，而bac无效）
给出C个字母，按字典序升序输出所有由这C个字母组成的长度为L的有效密码。

>输入格式：
第一行两个整数L，C
第二行C个不同的小写字母，两个字母间有一个空格
$3 \le L \le 15$
$1 \le C \le 26$

>输出格式：
每行一个有效密码，按字典序升序输出

样例输入 | 样例输出
------------ | ------------
5 3</br>a e x y z |  axy </br> axz </br> ayz </br> exy </br> exz </br> eyz

## 四. 提高巩固

1.n皇后问题
>在n*n的国际象棋棋盘中放n个皇后，使它们无法互相攻击，输出每种方案。
皇后攻击范围为它所在的行、列、对角线。
对于一种方案，易知n个皇后分别在第1~n行。
每种方案输出n个数字，表示第1行,第2行,...,第n行的皇后所在的列号。
按字典序升序输出。
$n \le 8$

>输入格式: 一个数n

>输出格式: 每行表示一种方案。按字典序升序输出。


样例输入 | 样例输出
------------ | ------------
4 | 2 4 1 3 </br> 3 1 4 2

 2.分书问题
 >有n本书，n个人。每个人都有自己喜欢的一些书。现在要将每本书分给不同的人，使得每个人都喜欢自己得到的书。问总共有多少种方案？
 $n \le 20$

>输入格式:
第一行一个数n
后一个n*n的01矩阵
矩阵中第i行第j列为1，表示第i个人喜欢第j本书，为0表示不喜欢。

>输出格式:一个数字表示方案数

样例输入 | 样例输出
------------ | ------------
 5 </br> 00110 </br> 11001 </br> 01100 </br> 00010 </br> 01001 | 1